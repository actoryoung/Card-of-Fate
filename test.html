<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试 - 命运河牌</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>运河牌 - 测试页面</h1>

        <div class="test-section">
            <h3>1. 模块加载测试</h3>
            <div id="module-test-result"></div>
            <button onclick="testModuleLoading()">测试模块加载</button>
        </div>

        <div class="test-section">
            <h3>2. 游戏初始化测试</h3>
            <div id="init-test-result"></div>
            <button onclick="testGameInit()">测试游戏初始化</button>
        </div>

        <div class="test-section">
            <h3>3. 界面切换测试</h3>
            <div id="ui-test-result"></div>
            <button onclick="testUISwitching()">测试界面切换</button>
        </div>

        <div class="test-section">
            <h3>4. HTML结构验证</h3>
            <div id="html-test-result"></div>
            <button onclick="testHTMLStructure()">验证HTML结构</button>
        </div>

        <div class="test-section">
            <h3>5. CSS样式验证</h3>
            <div id="css-test-result"></div>
            <button onclick="testCSSStyles()">验证CSS样式</button>
        </div>
    </div>

    <!-- 加载游戏资源 -->
    <script type="module">
        // 测试模块加载
        window.testModuleLoading = async function() {
            const resultDiv = document.getElementById('module-test-result');
            resultDiv.innerHTML = '<div class="test-result">正在测试模块加载...</div>';

            try {
                // 测试主要模块
                const gameModule = await import('./src/core/Game.js');
                const rendererModule = await import('./src/ui/GameRenderer.js');

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ✓ Game模块加载成功<br>
                        ✓ GameRenderer模块加载成功<br>
                        ✓ 所有模块导入路径正确
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ✗ 模块加载失败: ${error.message}<br>
                        请检查模块路径和文件是否存在
                    </div>
                `;
            }
        };

        // 测试游戏初始化
        window.testGameInit = async function() {
            const resultDiv = document.getElementById('init-test-result');
            resultDiv.innerHTML = '<div class="test-result">正在测试游戏初始化...</div>';

            try {
                const { Game } = await import('./src/core/Game.js');
                const game = new Game();

                // 模拟初始化
                await game.initialize();

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ✓ 游戏实例创建成功<br>
                        ✓ 游戏初始化完成<br>
                        ✓ 游戏状态正常
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ✗ 游戏初始化失败: ${error.message}<br>
                        请检查游戏数据和依赖
                    </div>
                `;
            }
        };
    </script>

    <!-- UI测试函数 -->
    <script>
        // 测试界面切换
        window.testUISwitching = function() {
            const resultDiv = document.getElementById('ui-test-result');

            try {
                // 检查界面元素
                const screens = document.querySelectorAll('.screen');
                if (screens.length === 0) {
                    throw new Error('未找到界面元素');
                }

                // 测试切换
                screens.forEach(screen => screen.classList.remove('active'));
                const mainMenu = document.getElementById('main-menu');
                if (mainMenu) {
                    mainMenu.classList.add('active');
                }

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ✓ 找到 ${screens.length} 个界面<br>
                        ✓ 界面切换功能正常<br>
                        ✓ 主菜单显示成功
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ✗ 界面切换失败: ${error.message}
                    </div>
                `;
            }
        };

        // 测试HTML结构
        window.testHTMLStructure = function() {
            const resultDiv = document.getElementById('html-test-result');
            let tests = [];

            try {
                // 检查必要的界面
                const requiredScreens = [
                    'main-menu',
                    'loading-screen',
                    'level-select-screen',
                    'combat-screen',
                    'reward-screen',
                    'game-over-screen'
                ];

                requiredScreens.forEach(screenId => {
                    const element = document.getElementById(screenId);
                    if (element) {
                        tests.push(`✓ ${screenId} 存在`);
                    } else {
                        tests.push(`✗ ${screenId} 缺失`);
                    }
                });

                // 检查按钮
                const buttons = ['btn-new-game', 'btn-load-game', 'btn-end-turn'];
                buttons.forEach(btnId => {
                    const btn = document.getElementById(btnId);
                    if (btn) {
                        tests.push(`✓ ${btnId} 存在`);
                    } else {
                        tests.push(`✗ ${btnId} 缺失`);
                    }
                });

                const allPassed = tests.every(t => t.startsWith('✓'));

                resultDiv.innerHTML = `
                    <div class="test-result ${allPassed ? 'success' : 'error'}">
                        ${tests.join('<br>')}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ✗ HTML结构验证失败: ${error.message}
                    </div>
                `;
            }
        };

        // 测试CSS样式
        window.testCSSStyles = function() {
            const resultDiv = document.getElementById('css-test-result');
            let tests = [];

            try {
                // 检查样式表是否加载
                const stylesheet = document.querySelector('link[href="src/styles/main.css"]');
                if (stylesheet) {
                    tests.push('✓ 主样式表加载成功');
                } else {
                    tests.push('✗ 主样式表未找到');
                }

                // 检查关键样式
                const styles = [
                    '.screen',
                    '.menu-title',
                    '.btn',
                    '.loading-text',
                    '.level-card',
                    '.game-board',
                    '.health-bar',
                    '.card'
                ];

                styles.forEach(style => {
                    const elements = document.querySelectorAll(style);
                    if (elements.length > 0) {
                        tests.push(`✓ ${style} 样式存在 (${elements.length} 个元素)`);
                    } else {
                        tests.push(`✗ ${style} 样式未应用`);
                    }
                });

                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ${tests.join('<br>')}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ✗ CSS样式验证失败: ${error.message}
                    </div>
                `;
            }
        };

        // 页面加载完成后自动运行测试
        window.addEventListener('load', function() {
            console.log('测试页面已加载');
            document.title += ' - 就绪';
        });
    </script>
</body>
</html>