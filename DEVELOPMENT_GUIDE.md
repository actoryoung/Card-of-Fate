# 命运河牌 - 开发流程指南

本文档描述如何使用规范驱动开发 (Spec-Driven Development) 流程开发命运卡牌游戏。

## 开发流程

```
┌─────────────────────────────────────────────────────────┐
│                    用户提出需求                            │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Orchestrator 分析任务                          │
│         - 任务分解                                        │
│         - 识别所需功能                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Spec-Writer 编写规范                           │
│         - 使用模板生成 SPEC 文档                          │
│         - 定义输入/输出/业务规则                           │
│         - 编写测试用例                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Orchestrator 验证规范                          │
│         - 检查规范完整性                                   │
│         - 确认可测试性                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Test-Writer 生成测试                           │
│         - 基于规范编写测试代码                             │
│         - 覆盖所有业务规则                                 │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Code-Writer 实现代码                           │
│         - 按照规范实现功能                                 │
│         - 确保通过测试                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│            Code-Reviewer 审查代码                         │
│         - 对照规范审查                                     │
│         - 检查代码质量                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
                    功能完成 ✅
```

## 角色职责

### Orchestrator (主控代理)
- 任务分析和分解
- 子代理调度
- 结果验证和整合
- 错误处理和重试决策

### Spec-Writer (规范编写代理)
- 读取设计文档
- 使用模板生成规范
- 定义功能需求和测试用例
- 输出：`.claude/specs/` 下的规范文件

### Test-Writer (测试编写代理)
- 读取规范文档
- 生成测试代码
- 输出：`tests/` 下的测试文件

### Code-Writer (代码实现代理)
- 读取规范文档
- 实现功能代码
- 确保测试通过
- 输出：`src/` 下的源代码

### Code-Reviewer (代码审查代理)
- 对照规范审查代码
- 检查代码质量
- 提出改进建议
- 输出：审查报告

## 验证闭环

每个子代理执行后，Orchestrator 必须进行验证：

### 错误分级
- **L1** - 表面错误（语法、格式）→ 直接修复
- **L2** - 逻辑错误（测试失败）→ 重试最多2次
- **L3** - 方案错误（设计缺陷）→ 回退检查点
- **L4** - 理解偏差（需求错误）→ 请求用户澄清

### 检查点
- `plan_approved` - 方案设计完成
- `spec_created` - 规范编写完成
- `tests_passing` - 测试编写完成
- `code_implemented` - 代码实现完成
- `review_done` - 代码审查完成

## 项目结构

```
new_try/
├── .claude/
│   ├── agents/           # 代理配置
│   ├── specs/            # 功能规范
│   │   ├── function/     # 函数级规范
│   │   ├── feature/      # 功能级规范
│   │   └── api/          # API规范
│   └── templates/        # 规范模板
├── docs/                 # 设计文档
├── data/                 # 游戏数据
├── src/                  # 源代码
├── tests/                # 测试代码
└── index.html            # 入口文件
```

## 快捷命令

```bash
# 启动开发服务器
npm start

# 运行测试（待配置）
npm test

# 生成新功能规范
/spec <功能名称>

# 实现功能（自动化）
/implement <功能名称>

# 代码审查
/review <文件路径>
```

## 开发状态追踪

当前开发阶段：**规范编写中**

- [x] 项目框架搭建
- [x] 设计文档编写
- [ ] 功能规范生成（进行中）
- [ ] 测试代码生成
- [ ] 核心功能实现
- [ ] UI 渲染实现
- [ ] 游戏流程整合
