# 运河牌游戏流程演示

## 游戏架构概述

### 核心模块
1. **Game.js** - 游戏主类，整合所有模块
2. **GameState.js** - 游戏状态管理（存档、进度）
3. **CardManager.js** - 卡牌管理（抽牌、打牌、卡组）
4. **CombatSystem.js** - 战斗系统（回合制、伤害计算）
5. **LevelManager.js** - 关卡管理（关卡数据、奖励）
6. **GameRenderer.js** - UI渲染

## 游戏流程

### 1. 游戏启动
```
index.html
    ↓
src/main.js (初始化游戏)
    ↓
Game.initialize()
    ↓
加载数据 → 创建初始卡组 → 显示主菜单
```

### 2. 主菜单
界面选项：
- **新游戏** - 重置所有进度，开始新游戏
- **继续游戏** - 加载最近的存档

### 3. 关卡选择
关卡类型：
- **普通** (normal) - 标准敌人，基础奖励
- **精英** (elite) - 强敌，更好奖励
- **BOSS** (boss) - 强力敌人，稀有奖励
- **休息** (rest) - 恢复生命值
- **商店** (shop) - 购买卡牌（开发中）

### 4. 战斗流程
```
进入关卡
    ↓
开始战斗 (CombatSystem.startCombat)
    ↓
玩家回合
    ├── 抽5张牌
    ├── 重置能量 (3点)
    ├── 打出手牌
    └── 结束回合
        ↓
敌人回合
    ├── 显示敌人意图
    ├── 执行敌人行动
    ├── 检查战斗结果
    └── 继续下一回合或结束战斗
```

### 5. 回合战斗细节
#### 玩家操作
- **抽牌** - 每回合开始自动抽5张牌
- **能量** - 每回合重置为3点
- **出牌** - 点击卡牌消耗能量使用
- **结束回合** - 弃置所有手牌，轮到敌人

#### 卡牌类型
- **攻击** - 对敌人造成伤害
- **防御** - 获得护甲
- **技能** - 特殊效果（抽牌、获得能量等）

#### 敌人AI
- **攻击** - 直接造成伤害
- **防御** - 获得护甲
- **技能** - 特殊攻击模式

### 6. 战斗结算
```
战斗结束
    ↓
检查结果
    ├── 胜利 → 发放奖励 → 解锁下一关
    ├── 失败 → 游戏结束
    └── 平局 → 特殊处理
```

### 7. 奖励系统
- **金币** - 用于购买卡牌（商店功能待开发）
- **卡牌选择** - 战斗后选择新卡牌加入卡组（待实现）

### 8. 存档系统
- **3个存档槽位**
- **自动保存** - 完成关卡后自动保存
- **手动保存** - 可随时保存到指定槽位
- **数据完整性** - 校验和验证防止存档损坏

## 模块间通信

### 数据流向
```
Game (主控制器)
    ↓
GameState ← → LevelManager
    ↓
CardManager ← → CombatSystem
    ↓
GameRenderer (UI展示)
```

### 事件系统
- **game.on('event', callback)** - 注册事件监听
- **game.emit('event', data)** - 触发事件
- **game.off('event', callback)** - 移除事件监听

### 主要事件
- `initialized` - 游戏初始化完成
- `newGameStarted` - 开始新游戏
- `combatStarted` - 战斗开始
- `playerTurnEnded` - 玩家回合结束
- `levelCompleted` - 关卡完成
- `gameVictory`/`gameDefeat` - 游戏胜利/失败

## 如何运行

1. 打开 `index.html` 文件
2. 点击"新游戏"开始
3. 选择关卡进入战斗
4. 点击卡牌使用，点击"结束回合"进行下一回合

## 开发状态

### 已实现功能
- ✅ 基础游戏框架
- ✅ 卡牌管理系统
- ✅ 战斗系统（基础）
- ✅ 关卡管理
- ✅ 存档系统
- ✅ UI渲染

### 待开发功能
- 🔄 商店系统
- 🔄 卡牌升级系统
- 🔄 更多敌人类型
- 🔄 音效和动画
- 🔄 更多关卡内容

## 技术栈

- **语言**: JavaScript ES6+
- **模块系统**: ES Modules
- **数据存储**: localStorage (降级到内存存储)
- **UI**: 原生 HTML/CSS/JavaScript
- **架构**: 模块化设计，依赖注入